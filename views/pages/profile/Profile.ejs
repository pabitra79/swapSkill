<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .nav-link {
        color: var(--text-dark) !important;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 8px;
        padding: 0.5rem 1rem !important;
      }

      .nav-link:hover {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: rgb(47, 10, 10) !important;
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <%- include('../../partials/navbar') %>

    <div class="container mt-4">
      <!-- Profile Header -->
      <div class="row align-items-center mb-4">
        <div class="col-md-8">
          <h2>üè∑Ô∏è <%= userProfile.name %></h2>
          <p class="lead">
            <% if (userProfile.profile.location) { %> <%=
            userProfile.profile.location %> <% } else { %> Location not set <% }
            %>
          </p>
          <div class="mb-2">
            <span class="text-warning">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span>4.8/5 (12 reviews)</span>
          </div>
          <% if (isOwnProfile) { %>
          <a href="/profile/edit" class="btn btn-primary">Edit Profile</a>
          <% } else { %>
          <button class="btn btn-primary">Send Swap Request</button>
          <% } %>
        </div>
        <div class="col-md-4 text-center">
          <% if (userProfile.profileImage) { %>
          <img
            src="<%= userProfile.profileImage %>"
            class="rounded-circle mb-2"
            alt="Profile"
            style="width: 150px; height: 150px; object-fit: cover"
          />
          <% } else { %>
          <div
            class="rounded-circle bg-secondary d-inline-flex align-items-center justify-content-center mb-2"
            style="width: 150px; height: 150px; color: white; font-size: 3rem"
          >
            <%= userProfile.name.charAt(0).toUpperCase() %>
          </div>
          <% } %> <% if (isOwnProfile) { %>
          <div>
            <button
              class="btn btn-outline-secondary btn-sm"
              onclick="document.getElementById('avatarUpload').click()"
            >
              Upload New
            </button>
            <input
              type="file"
              id="avatarUpload"
              style="display: none"
              accept="image/*"
            />
          </div>
          <% } %>
        </div>
      </div>

      <div class="row">
        <!-- Left Column -->
        <div class="col-md-6">
          <!-- Bio -->
          <div class="card mb-4">
            <div class="card-body">
              <h5>üè∑Ô∏è BIO</h5>
              <p>
                <% if (userProfile.profile.bio) { %> <%= userProfile.profile.bio
                %> <% } else { %>
                <em class="text-muted">No bio added yet</em>
                <% } %>
              </p>
            </div>
          </div>

          <!-- Details -->
          <div class="card mb-4">
            <div class="card-body">
              <h5>üìç DETAILS</h5>
              <ul class="list-unstyled">
                <li>
                  üìç <strong>Location:</strong>
                  <%= userProfile.profile.location || 'Not specified' %>
                </li>
                <li>
                  üïê <strong>Availability:</strong>
                  <%= userProfile.profile.availability || 'Not specified' %>
                </li>
                <li>
                  üó£Ô∏è <strong>Language:</strong>
                  <%= userProfile.profile.language || 'Not specified' %>
                </li>
                <li>
                  üåê <strong>Timezone:</strong>
                  <%= userProfile.profile.timezone || 'Not specified' %>
                </li>
                <% if (userProfile.profile.experienceLevel) { %>
                <li>
                  üìä <strong>Experience:</strong>
                  <%= userProfile.profile.experienceLevel %>
                </li>
                <% } %> <% if (userProfile.profile.hourlyRate) { %>
                <li>
                  üí∞ <strong>Hourly Rate:</strong> $<%=
                  userProfile.profile.hourlyRate %>
                </li>
                <% } %>
              </ul>
            </div>
          </div>

          <!-- Skills -->
          <div class="card">
            <div class="card-body">
              <h5>üí° I TEACH:</h5>
              <% if (userProfile.profile.teachSkills &&
              userProfile.profile.teachSkills.length > 0) { %>
              <ul>
                <% userProfile.profile.teachSkills.forEach(skill => { %>
                <li><%= skill %></li>
                <% }); %>
              </ul>
              <% } else { %>
              <p class="text-muted"><em>No teaching skills added</em></p>
              <% } %>

              <h5 class="mt-4">üéØ I WANT TO LEARN:</h5>
              <% if (userProfile.profile.learnSkills &&
              userProfile.profile.learnSkills.length > 0) { %>
              <ul>
                <% userProfile.profile.learnSkills.forEach(skill => { %>
                <li><%= skill %></li>
                <% }); %>
              </ul>
              <% } else { %>
              <p class="text-muted"><em>No learning goals added</em></p>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="col-md-6">
          <!-- Stats -->
          <div class="card mb-4">
            <div class="card-body">
              <h5>üìä STATS & ACTIVITY</h5>
              <div class="row text-center">
                <div class="col-6">
                  <div class="h4 text-primary">
                    <%= userProfile.stats.completedSessions || 0 %>
                  </div>
                  <small>Completed Sessions</small>
                </div>
                <div class="col-6">
                  <div class="h4 text-primary">
                    <%= userProfile.stats.hoursTaught || 0 %>
                  </div>
                  <small>Hours Taught</small>
                </div>
              </div>
              <div class="row text-center mt-3">
                <div class="col-6">
                  <div class="h4 text-primary">
                    <%= userProfile.stats.hoursLearned || 0 %>
                  </div>
                  <small>Hours Learned</small>
                </div>
                <div class="col-6">
                  <div class="h4 text-primary">
                    <%= userProfile.stats.responseRate || 0 %>%
                  </div>
                  <small>Response Rate</small>
                </div>
              </div>
              <div class="mt-3">
                <small class="text-muted"
                  >Member Since: <%= userProfile.createdAt.toLocaleDateString()
                  %></small
                >
              </div>
            </div>
          </div>

          <!-- Reviews -->
          <div class="card">
            <div class="card-body">
              <h5>üèÜ RECENT REVIEWS</h5>

              <!-- Placeholder for reviews - you can add dynamic reviews later -->
              <div class="border rounded p-3 mb-3">
                <div class="text-warning">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p>
                  "<%= userProfile.name %> is an amazing teacher! Very patient
                  and knowledgeable."
                </p>
                <div class="d-flex justify-content-between">
                  <strong>- Sarah</strong>
                  <small class="text-muted">2 days ago</small>
                </div>
              </div>

              <div class="border rounded p-3">
                <div class="text-warning">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</div>
                <p>"Great at explaining complex topics in simple way."</p>
                <div class="d-flex justify-content-between">
                  <strong>- Mike</strong>
                  <small class="text-muted">1 week ago</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Avatar upload functionality
      document
        .getElementById("avatarUpload")
        ?.addEventListener("change", async function (e) {
          const file = e.target.files[0];
          if (!file) return;

          const formData = new FormData();
          formData.append("avatar", file);

          try {
            const response = await fetch("/profile/upload-avatar", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();

            if (result.success) {
              // Reload page to show new avatar
              window.location.reload();
            } else {
              alert("Failed to upload avatar: " + result.error);
            }
          } catch (error) {
            alert("Error uploading avatar");
          }
        });
    </script>
  </body>
</html>
